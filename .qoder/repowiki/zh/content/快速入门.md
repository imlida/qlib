# 快速入门

<cite>
**本文档中引用的文件**   
- [README.md](file://README.md)
- [installation.rst](file://docs/start/installation.rst)
- [getdata.rst](file://docs/start/getdata.rst)
- [initialization.rst](file://docs/start/initialization.rst)
- [get_data.py](file://scripts/get_data.py)
- [workflow_config_lightgbm_Alpha158.yaml](file://examples/benchmarks/LightGBM/workflow_config_lightgbm_Alpha158.yaml)
- [workflow_by_code.py](file://examples/workflow_by_code.py)
- [__init__.py](file://qlib/__init__.py)
- [config.py](file://qlib/config.py)
- [data.py](file://qlib/tests/data.py)
- [pyproject.toml](file://pyproject.toml)
- [setup.py](file://setup.py)
</cite>

## 目录
1. [环境安装](#环境安装)
2. [数据获取](#数据获取)
3. [初始化配置](#初始化配置)
4. [运行工作流](#运行工作流)
5. [验证与结果](#验证与结果)

## 环境安装

QLib支持通过pip安装和从源码安装两种方式。建议使用conda管理Python环境以避免依赖问题。

### 通过pip安装

最简单的安装方式是使用pip：

```bash
pip install pyqlib
```

此命令将安装最新的稳定版本。QLib支持Python 3.8至3.12版本。

### 从源码安装

对于需要最新开发版本的用户，可以从源码安装：

```bash
# 安装依赖
pip install numpy
pip install --upgrade cython

# 克隆并安装
git clone https://github.com/microsoft/qlib.git && cd qlib
pip install .
```

**Mac M1用户注意事项**：如果遇到LightGBM构建问题，需先安装OpenMP：
```bash
brew install libomp
```

**Windows用户注意事项**：如果使用NFS功能，需要在系统中启用NFS服务。

**验证安装**：
```python
import qlib
print(qlib.__version__)
```

**Section sources**
- [README.md](file://README.md#L168-L210)
- [installation.rst](file://docs/start/installation.rst#L10-L47)
- [pyproject.toml](file://pyproject.toml#L27-L57)
- [setup.py](file://setup.py#L1-L26)

## 数据获取

QLib提供了`get_data.py`脚本用于下载示例数据集。数据集基于Yahoo Finance的公开数据。

### 下载中国股市数据

```bash
python scripts/get_data.py qlib_data --target_dir ~/.qlib/qlib_data/cn_data --region cn
```

此命令将下载中国股市的日频数据到指定目录。`--region`参数指定市场区域，`--target_dir`指定存储路径。

### 参数配置

`get_data.py`支持以下关键参数：
- `name`: 数据集名称，如`qlib_data`
- `target_dir`: 数据存储目录
- `interval`: 数据频率，支持`1d`(日频)和`1min`(分钟频)
- `region`: 市场区域，支持`cn`(中国)和`us`(美国)
- `exists_skip`: 如果数据已存在是否跳过下载

### 网络问题应对

由于数据源限制，官方数据集可能暂时不可用。社区提供了替代数据源：

```bash
wget https://github.com/chenditc/investment_data/releases/latest/download/qlib_bin.tar.gz
mkdir -p ~/.qlib/qlib_data/cn_data
tar -zxvf qlib_bin.tar.gz -C ~/.qlib/qlib_data/cn_data --strip-components=1
```

**数据健康检查**：
```bash
python scripts/check_data_health.py check_data --qlib_dir ~/.qlib/qlib_data/cn_data
```

**Section sources**
- [README.md](file://README.md#L212-L291)
- [get_data.py](file://scripts/get_data.py#L1-L10)
- [data.py](file://qlib/tests/data.py#L18-L200)
- [initialization.rst](file://docs/start/initialization.rst#L15-L22)

## 初始化配置

在使用QLib前，需要进行初始化配置，主要设置数据路径和市场区域。

### 基本初始化

```python
import qlib
from qlib.constant import REG_CN

# 初始化配置
provider_uri = "~/.qlib/qlib_data/cn_data"
qlib.init(provider_uri=provider_uri, region=REG_CN)
```

### 配置参数

`qlib.init()`支持以下重要参数：

| 参数 | 类型 | 说明 |
|------|------|------|
| `provider_uri` | str | Qlib数据URI，指向数据存储位置 |
| `region` | str | 市场区域，`REG_CN`为中国，`REG_US`为美国 |
| `redis_host` | str | Redis主机地址，用于缓存机制 |
| `redis_port` | int | Redis端口号 |
| `exp_manager` | dict | 实验管理器配置，用于MLflow集成 |
| `mongo` | dict | MongoDB配置，用于任务管理 |
| `logging_level` | int | 系统日志级别 |

**注意事项**：
- `region`参数应与`provider_uri`中的数据区域一致
- 如果无法连接Redis，缓存机制将不可用
- 不要在QLib仓库目录内导入qlib包，否则可能出错

**Section sources**
- [initialization.rst](file://docs/start/initialization.rst#L24-L98)
- [__init__.py](file://qlib/__init__.py#L25-L318)
- [config.py](file://qlib/config.py#L134-L200)

## 运行工作流

QLib支持通过YAML配置文件或代码方式运行完整的工作流。

### 通过YAML配置运行

使用`qrun`命令和YAML配置文件运行LightGBM模型：

```bash
cd examples
qrun benchmarks/LightGBM/workflow_config_lightgbm_Alpha158.yaml
```

**YAML配置文件结构**：
```yaml
qlib_init:
    provider_uri: "~/.qlib/qlib_data/cn_data"
    region: cn
task:
    model:
        class: LGBModel
        module_path: qlib.contrib.model.gbdt
        kwargs:
            loss: mse
            learning_rate: 0.2
    dataset:
        class: DatasetH
        module_path: qlib.data.dataset
        kwargs:
            handler:
                class: Alpha158
                module_path: qlib.contrib.data.handler
```

### 通过代码运行

创建自定义工作流：

```python
import qlib
from qlib.utils import init_instance_by_config
from qlib.workflow import R
from qlib.workflow.record_temp import SignalRecord, PortAnaRecord

# 初始化
provider_uri = "~/.qlib/qlib_data/cn_data"
qlib.init(provider_uri=provider_uri, region=REG_CN)

# 加载配置并初始化模型和数据集
model = init_instance_by_config(config["model"])
dataset = init_instance_by_config(config["dataset"])

# 开始实验
with R.start(experiment_name="workflow"):
    model.fit(dataset)
    
    # 生成信号记录
    recorder = R.get_recorder()
    sr = SignalRecord(model, dataset, recorder)
    sr.generate()
    
    # 生成回测分析
    par = PortAnaRecord(recorder, port_analysis_config)
    par.generate()
```

**Section sources**
- [workflow_config_lightgbm_Alpha158.yaml](file://examples/benchmarks/LightGBM/workflow_config_lightgbm_Alpha158.yaml#L1-L72)
- [workflow_by_code.py](file://examples/workflow_by_code.py#L1-L86)
- [__init__.py](file://qlib/__init__.py#L25-L318)

## 验证与结果

成功运行工作流后，系统将输出详细的性能分析结果。

### 预期输出

```bash
'The following are analysis results of the excess return without cost.'
                       risk
mean               0.000708
std                0.005626
annualized_return  0.178316
information_ratio  1.996555
max_drawdown      -0.081806
'The following are analysis results of the excess return with cost.'
                       risk
mean               0.000512
std                0.005626
annualized_return  0.128982
information_ratio  1.444287
max_drawdown      -0.091078
```

### 结果验证

关键性能指标包括：
- **年化收益率**(annualized_return): 无成本情况下约17.83%
- **信息比率**(information_ratio): 无成本情况下约1.99
- **最大回撤**(max_drawdown): 无成本情况下约-8.18%

### 常见问题解决方案

1. **安装失败**：检查Python版本是否为3.8或更高，确保安装了numpy和cython
2. **数据下载失败**：尝试使用社区提供的替代数据源
3. **多进程错误**：在Windows系统中，确保在`if __name__ == '__main__':`块中运行代码
4. **Redis连接失败**：检查Redis服务是否运行，或在初始化时设置`redis_host`和`redis_port`

**Section sources**
- [README.md](file://README.md#L366-L382)
- [getdata.rst](file://docs/start/getdata.rst#L30-L118)
- [FAQ.rst](file://docs/FAQ/FAQ.rst#L15-L42)